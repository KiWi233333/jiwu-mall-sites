import{b8 as mt,b3 as at}from"./entry.t-rqPOs0.js";var st=function(){var r=function(n,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var e in i)i.hasOwnProperty(e)&&(o[e]=i[e])},r(n,t)};return function(n,t){r(n,t);function o(){this.constructor=n}n.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}}(),b;(function(r){r.InvalidFile="InvalidFile",r.InvalidToken="InvalidToken",r.InvalidMetadata="InvalidMetadata",r.InvalidChunkSize="InvalidChunkSize",r.InvalidCustomVars="InvalidCustomVars",r.NotAvailableUploadHost="NotAvailableUploadHost",r.ReadCacheFailed="ReadCacheFailed",r.InvalidCacheData="InvalidCacheData",r.WriteCacheFailed="WriteCacheFailed",r.RemoveCacheFailed="RemoveCacheFailed",r.GetCanvasContextFailed="GetCanvasContextFailed",r.UnsupportedFileType="UnsupportedFileType",r.FileReaderReadFailed="FileReaderReadFailed",r.NotAvailableXMLHttpRequest="NotAvailableXMLHttpRequest",r.InvalidProgressEventTarget="InvalidProgressEventTarget",r.RequestError="RequestError"})(b||(b={}));var w=function(){function r(n,t){this.name=n,this.message=t,this.stack=new Error().stack}return r}(),D=function(r){st(n,r);function n(t,o,i,e){var f=r.call(this,b.RequestError,i)||this;return f.code=t,f.reqId=o,f.isRequestError=!0,f.data=e,f}return n}(w),bt=function(r){st(n,r);function n(t,o){return o===void 0&&(o=""),r.call(this,0,o,t)||this}return n}(D),wt=function(){function r(n,t){this.runTask=n,this.limit=t,this.aborted=!1,this.queue=[],this.processing=[]}return r.prototype.enqueue=function(n){var t=this;return new Promise(function(o,i){t.queue.push({task:n,resolve:o,reject:i}),t.check()})},r.prototype.run=function(n){var t=this;this.queue=this.queue.filter(function(o){return o!==n}),this.processing.push(n),this.runTask(n.task).then(function(){t.processing=t.processing.filter(function(o){return o!==n}),n.resolve(),t.check()},function(o){return n.reject(o)})},r.prototype.check=function(){var n=this;if(!this.aborted){var t=this.processing.length,o=this.limit-t;this.queue.slice(0,o).forEach(function(i){n.run(i)})}},r.prototype.abort=function(){this.queue=[],this.aborted=!0},r}(),_t=function(){var r=function(n,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var e in i)i.hasOwnProperty(e)&&(o[e]=i[e])},r(n,t)};return function(n,t){r(n,t);function o(){this.constructor=n}n.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}}(),T=function(){return T=Object.assign||function(r){for(var n,t=1,o=arguments.length;t<o;t++){n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(r[i]=n[i])}return r},T.apply(this,arguments)},xt=function(){function r(){this.closed=!1}return r.prototype.unsubscribe=function(){this.closed||(this.closed=!0,this._unsubscribe&&this._unsubscribe())},r.prototype.add=function(n){this._unsubscribe=n},r}(),Ct=function(r){_t(n,r);function n(t,o,i){var e=r.call(this)||this;return e.isStopped=!1,t&&typeof t=="object"?e.destination=t:e.destination=T(T(T({},t&&{next:t}),o&&{error:o}),i&&{complete:i}),e}return n.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,r.prototype.unsubscribe.call(this))},n.prototype.next=function(t){!this.isStopped&&this.destination.next&&this.destination.next(t)},n.prototype.error=function(t){!this.isStopped&&this.destination.error&&(this.isStopped=!0,this.destination.error(t))},n.prototype.complete=function(t){!this.isStopped&&this.destination.complete&&(this.isStopped=!0,this.destination.complete(t))},n}(xt),St=function(){function r(n){this._subscribe=n}return r.prototype.subscribe=function(n,t,o){var i=new Ct(n,t,o);return i.add(this._subscribe(i)),i},r}();function At(r){if(r===null||typeof r>"u")return"";var n=r+"",t="",o,i,e=0;o=i=0,e=n.length;for(var f=0;f<e;f++){var d=n.charCodeAt(f),y=null;if(d<128)i++;else if(d>127&&d<2048)y=String.fromCharCode(d>>6|192,d&63|128);else if((d&63488^55296)>0)y=String.fromCharCode(d>>12|224,d>>6&63|128,d&63|128);else{if((d&64512^55296)>0)throw new RangeError("Unmatched trail surrogate at "+f);var a=n.charCodeAt(++f);if((a&64512^56320)>0)throw new RangeError("Unmatched lead surrogate at "+(f-1));d=((d&1023)<<10)+(a&1023)+65536,y=String.fromCharCode(d>>18|240,d>>12&63|128,d>>6&63|128,d&63|128)}y!==null&&(i>o&&(t+=n.slice(o,i)),t+=y,o=i=f+1)}return i>o&&(t+=n.slice(o,e)),t}function kt(r){var n=[],t=0,o=0,i=0;for(r+="";t<r.length;){o=r.charCodeAt(t)&255,i=0,o<=191?(o=o&127,i=1):o<=223?(o=o&31,i=2):o<=239?(o=o&15,i=3):(o=o&7,i=4);for(var e=1;e<i;++e)o=o<<6|r.charCodeAt(e+t)&63;i===4?(o-=65536,n.push(String.fromCharCode(55296|o>>10&1023)),n.push(String.fromCharCode(56320|o&1023))):n.push(String.fromCharCode(o)),t+=i}return n.join("")}function It(r){var n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",t,o,i,e,f,d,y,a,h=0,v=0,_="",x=[];if(!r)return r;r=At(r+"");do t=r.charCodeAt(h++),o=r.charCodeAt(h++),i=r.charCodeAt(h++),a=t<<16|o<<8|i,e=a>>18&63,f=a>>12&63,d=a>>6&63,y=a&63,x[v++]=n.charAt(e)+n.charAt(f)+n.charAt(d)+n.charAt(y);while(h<r.length);switch(_=x.join(""),r.length%3){case 1:_=_.slice(0,-2)+"==";break;case 2:_=_.slice(0,-1)+"=";break}return _}function Ut(r){var n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",t,o,i,e,f,d,y,a,h=0,v=0,_="",x=[];if(!r)return r;r+="";do e=n.indexOf(r.charAt(h++)),f=n.indexOf(r.charAt(h++)),d=n.indexOf(r.charAt(h++)),y=n.indexOf(r.charAt(h++)),a=e<<18|f<<12|d<<6|y,t=a>>16&255,o=a>>8&255,i=a&255,d===64?x[v++]=String.fromCharCode(t):y===64?x[v++]=String.fromCharCode(t,o):x[v++]=String.fromCharCode(t,o,i);while(h<r.length);return _=x.join(""),kt(_)}function ut(r){return r=It(r),r.replace(/\//g,"_").replace(/\+/g,"-")}function Ft(r){return r=r.replace(/_/g,"/").replace(/-/g,"+"),Ut(r)}var ft={exports:{}};(function(r,n){(function(t){r.exports=t()})(function(t){var o=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];function i(g,p){var u=g[0],s=g[1],l=g[2],c=g[3];u+=(s&l|~s&c)+p[0]-680876936|0,u=(u<<7|u>>>25)+s|0,c+=(u&s|~u&l)+p[1]-389564586|0,c=(c<<12|c>>>20)+u|0,l+=(c&u|~c&s)+p[2]+606105819|0,l=(l<<17|l>>>15)+c|0,s+=(l&c|~l&u)+p[3]-1044525330|0,s=(s<<22|s>>>10)+l|0,u+=(s&l|~s&c)+p[4]-176418897|0,u=(u<<7|u>>>25)+s|0,c+=(u&s|~u&l)+p[5]+1200080426|0,c=(c<<12|c>>>20)+u|0,l+=(c&u|~c&s)+p[6]-1473231341|0,l=(l<<17|l>>>15)+c|0,s+=(l&c|~l&u)+p[7]-45705983|0,s=(s<<22|s>>>10)+l|0,u+=(s&l|~s&c)+p[8]+1770035416|0,u=(u<<7|u>>>25)+s|0,c+=(u&s|~u&l)+p[9]-1958414417|0,c=(c<<12|c>>>20)+u|0,l+=(c&u|~c&s)+p[10]-42063|0,l=(l<<17|l>>>15)+c|0,s+=(l&c|~l&u)+p[11]-1990404162|0,s=(s<<22|s>>>10)+l|0,u+=(s&l|~s&c)+p[12]+1804603682|0,u=(u<<7|u>>>25)+s|0,c+=(u&s|~u&l)+p[13]-40341101|0,c=(c<<12|c>>>20)+u|0,l+=(c&u|~c&s)+p[14]-1502002290|0,l=(l<<17|l>>>15)+c|0,s+=(l&c|~l&u)+p[15]+1236535329|0,s=(s<<22|s>>>10)+l|0,u+=(s&c|l&~c)+p[1]-165796510|0,u=(u<<5|u>>>27)+s|0,c+=(u&l|s&~l)+p[6]-1069501632|0,c=(c<<9|c>>>23)+u|0,l+=(c&s|u&~s)+p[11]+643717713|0,l=(l<<14|l>>>18)+c|0,s+=(l&u|c&~u)+p[0]-373897302|0,s=(s<<20|s>>>12)+l|0,u+=(s&c|l&~c)+p[5]-701558691|0,u=(u<<5|u>>>27)+s|0,c+=(u&l|s&~l)+p[10]+38016083|0,c=(c<<9|c>>>23)+u|0,l+=(c&s|u&~s)+p[15]-660478335|0,l=(l<<14|l>>>18)+c|0,s+=(l&u|c&~u)+p[4]-405537848|0,s=(s<<20|s>>>12)+l|0,u+=(s&c|l&~c)+p[9]+568446438|0,u=(u<<5|u>>>27)+s|0,c+=(u&l|s&~l)+p[14]-1019803690|0,c=(c<<9|c>>>23)+u|0,l+=(c&s|u&~s)+p[3]-187363961|0,l=(l<<14|l>>>18)+c|0,s+=(l&u|c&~u)+p[8]+1163531501|0,s=(s<<20|s>>>12)+l|0,u+=(s&c|l&~c)+p[13]-1444681467|0,u=(u<<5|u>>>27)+s|0,c+=(u&l|s&~l)+p[2]-51403784|0,c=(c<<9|c>>>23)+u|0,l+=(c&s|u&~s)+p[7]+1735328473|0,l=(l<<14|l>>>18)+c|0,s+=(l&u|c&~u)+p[12]-1926607734|0,s=(s<<20|s>>>12)+l|0,u+=(s^l^c)+p[5]-378558|0,u=(u<<4|u>>>28)+s|0,c+=(u^s^l)+p[8]-2022574463|0,c=(c<<11|c>>>21)+u|0,l+=(c^u^s)+p[11]+1839030562|0,l=(l<<16|l>>>16)+c|0,s+=(l^c^u)+p[14]-35309556|0,s=(s<<23|s>>>9)+l|0,u+=(s^l^c)+p[1]-1530992060|0,u=(u<<4|u>>>28)+s|0,c+=(u^s^l)+p[4]+1272893353|0,c=(c<<11|c>>>21)+u|0,l+=(c^u^s)+p[7]-155497632|0,l=(l<<16|l>>>16)+c|0,s+=(l^c^u)+p[10]-1094730640|0,s=(s<<23|s>>>9)+l|0,u+=(s^l^c)+p[13]+681279174|0,u=(u<<4|u>>>28)+s|0,c+=(u^s^l)+p[0]-358537222|0,c=(c<<11|c>>>21)+u|0,l+=(c^u^s)+p[3]-722521979|0,l=(l<<16|l>>>16)+c|0,s+=(l^c^u)+p[6]+76029189|0,s=(s<<23|s>>>9)+l|0,u+=(s^l^c)+p[9]-640364487|0,u=(u<<4|u>>>28)+s|0,c+=(u^s^l)+p[12]-421815835|0,c=(c<<11|c>>>21)+u|0,l+=(c^u^s)+p[15]+530742520|0,l=(l<<16|l>>>16)+c|0,s+=(l^c^u)+p[2]-995338651|0,s=(s<<23|s>>>9)+l|0,u+=(l^(s|~c))+p[0]-198630844|0,u=(u<<6|u>>>26)+s|0,c+=(s^(u|~l))+p[7]+1126891415|0,c=(c<<10|c>>>22)+u|0,l+=(u^(c|~s))+p[14]-1416354905|0,l=(l<<15|l>>>17)+c|0,s+=(c^(l|~u))+p[5]-57434055|0,s=(s<<21|s>>>11)+l|0,u+=(l^(s|~c))+p[12]+1700485571|0,u=(u<<6|u>>>26)+s|0,c+=(s^(u|~l))+p[3]-1894986606|0,c=(c<<10|c>>>22)+u|0,l+=(u^(c|~s))+p[10]-1051523|0,l=(l<<15|l>>>17)+c|0,s+=(c^(l|~u))+p[1]-2054922799|0,s=(s<<21|s>>>11)+l|0,u+=(l^(s|~c))+p[8]+1873313359|0,u=(u<<6|u>>>26)+s|0,c+=(s^(u|~l))+p[15]-30611744|0,c=(c<<10|c>>>22)+u|0,l+=(u^(c|~s))+p[6]-1560198380|0,l=(l<<15|l>>>17)+c|0,s+=(c^(l|~u))+p[13]+1309151649|0,s=(s<<21|s>>>11)+l|0,u+=(l^(s|~c))+p[4]-145523070|0,u=(u<<6|u>>>26)+s|0,c+=(s^(u|~l))+p[11]-1120210379|0,c=(c<<10|c>>>22)+u|0,l+=(u^(c|~s))+p[2]+718787259|0,l=(l<<15|l>>>17)+c|0,s+=(c^(l|~u))+p[9]-343485551|0,s=(s<<21|s>>>11)+l|0,g[0]=u+g[0]|0,g[1]=s+g[1]|0,g[2]=l+g[2]|0,g[3]=c+g[3]|0}function e(g){var p=[],u;for(u=0;u<64;u+=4)p[u>>2]=g.charCodeAt(u)+(g.charCodeAt(u+1)<<8)+(g.charCodeAt(u+2)<<16)+(g.charCodeAt(u+3)<<24);return p}function f(g){var p=[],u;for(u=0;u<64;u+=4)p[u>>2]=g[u]+(g[u+1]<<8)+(g[u+2]<<16)+(g[u+3]<<24);return p}function d(g){var p=g.length,u=[1732584193,-271733879,-1732584194,271733878],s,l,c,C,k,I;for(s=64;s<=p;s+=64)i(u,e(g.substring(s-64,s)));for(g=g.substring(s-64),l=g.length,c=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],s=0;s<l;s+=1)c[s>>2]|=g.charCodeAt(s)<<(s%4<<3);if(c[s>>2]|=128<<(s%4<<3),s>55)for(i(u,c),s=0;s<16;s+=1)c[s]=0;return C=p*8,C=C.toString(16).match(/(.*?)(.{0,8})$/),k=parseInt(C[2],16),I=parseInt(C[1],16)||0,c[14]=k,c[15]=I,i(u,c),u}function y(g){var p=g.length,u=[1732584193,-271733879,-1732584194,271733878],s,l,c,C,k,I;for(s=64;s<=p;s+=64)i(u,f(g.subarray(s-64,s)));for(g=s-64<p?g.subarray(s-64):new Uint8Array(0),l=g.length,c=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],s=0;s<l;s+=1)c[s>>2]|=g[s]<<(s%4<<3);if(c[s>>2]|=128<<(s%4<<3),s>55)for(i(u,c),s=0;s<16;s+=1)c[s]=0;return C=p*8,C=C.toString(16).match(/(.*?)(.{0,8})$/),k=parseInt(C[2],16),I=parseInt(C[1],16)||0,c[14]=k,c[15]=I,i(u,c),u}function a(g){var p="",u;for(u=0;u<4;u+=1)p+=o[g>>u*8+4&15]+o[g>>u*8&15];return p}function h(g){var p;for(p=0;p<g.length;p+=1)g[p]=a(g[p]);return g.join("")}h(d("hello")),typeof ArrayBuffer<"u"&&!ArrayBuffer.prototype.slice&&function(){function g(p,u){return p=p|0||0,p<0?Math.max(p+u,0):Math.min(p,u)}ArrayBuffer.prototype.slice=function(p,u){var s=this.byteLength,l=g(p,s),c=s,C,k,I,K;return u!==t&&(c=g(u,s)),l>c?new ArrayBuffer(0):(C=c-l,k=new ArrayBuffer(C),I=new Uint8Array(k),K=new Uint8Array(this,l,C),I.set(K),k)}}();function v(g){return/[\u0080-\uFFFF]/.test(g)&&(g=unescape(encodeURIComponent(g))),g}function _(g,p){var u=g.length,s=new ArrayBuffer(u),l=new Uint8Array(s),c;for(c=0;c<u;c+=1)l[c]=g.charCodeAt(c);return p?l:s}function x(g){return String.fromCharCode.apply(null,new Uint8Array(g))}function S(g,p,u){var s=new Uint8Array(g.byteLength+p.byteLength);return s.set(new Uint8Array(g)),s.set(new Uint8Array(p),g.byteLength),u?s:s.buffer}function A(g){var p=[],u=g.length,s;for(s=0;s<u-1;s+=2)p.push(parseInt(g.substr(s,2),16));return String.fromCharCode.apply(String,p)}function m(){this.reset()}return m.prototype.append=function(g){return this.appendBinary(v(g)),this},m.prototype.appendBinary=function(g){this._buff+=g,this._length+=g.length;var p=this._buff.length,u;for(u=64;u<=p;u+=64)i(this._hash,e(this._buff.substring(u-64,u)));return this._buff=this._buff.substring(u-64),this},m.prototype.end=function(g){var p=this._buff,u=p.length,s,l=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],c;for(s=0;s<u;s+=1)l[s>>2]|=p.charCodeAt(s)<<(s%4<<3);return this._finish(l,u),c=h(this._hash),g&&(c=A(c)),this.reset(),c},m.prototype.reset=function(){return this._buff="",this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},m.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash.slice()}},m.prototype.setState=function(g){return this._buff=g.buff,this._length=g.length,this._hash=g.hash,this},m.prototype.destroy=function(){delete this._hash,delete this._buff,delete this._length},m.prototype._finish=function(g,p){var u=p,s,l,c;if(g[u>>2]|=128<<(u%4<<3),u>55)for(i(this._hash,g),u=0;u<16;u+=1)g[u]=0;s=this._length*8,s=s.toString(16).match(/(.*?)(.{0,8})$/),l=parseInt(s[2],16),c=parseInt(s[1],16)||0,g[14]=l,g[15]=c,i(this._hash,g)},m.hash=function(g,p){return m.hashBinary(v(g),p)},m.hashBinary=function(g,p){var u=d(g),s=h(u);return p?A(s):s},m.ArrayBuffer=function(){this.reset()},m.ArrayBuffer.prototype.append=function(g){var p=S(this._buff.buffer,g,!0),u=p.length,s;for(this._length+=g.byteLength,s=64;s<=u;s+=64)i(this._hash,f(p.subarray(s-64,s)));return this._buff=s-64<u?new Uint8Array(p.buffer.slice(s-64)):new Uint8Array(0),this},m.ArrayBuffer.prototype.end=function(g){var p=this._buff,u=p.length,s=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],l,c;for(l=0;l<u;l+=1)s[l>>2]|=p[l]<<(l%4<<3);return this._finish(s,u),c=h(this._hash),g&&(c=A(c)),this.reset(),c},m.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},m.ArrayBuffer.prototype.getState=function(){var g=m.prototype.getState.call(this);return g.buff=x(g.buff),g},m.ArrayBuffer.prototype.setState=function(g){return g.buff=_(g.buff,!0),m.prototype.setState.call(this,g)},m.ArrayBuffer.prototype.destroy=m.prototype.destroy,m.ArrayBuffer.prototype._finish=m.prototype._finish,m.ArrayBuffer.hash=function(g,p){var u=y(new Uint8Array(g)),s=h(u);return p?A(s):s},m})})(ft);var Ot=ft.exports;const zt=mt(Ot);var M=function(){return M=Object.assign||function(r){for(var n,t=1,o=arguments.length;t<o;t++){n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(r[i]=n[i])}return r},M.apply(this,arguments)},Rt=function(r,n,t,o){function i(e){return e instanceof t?e:new t(function(f){f(e)})}return new(t||(t=Promise))(function(e,f){function d(h){try{a(o.next(h))}catch(v){f(v)}}function y(h){try{a(o.throw(h))}catch(v){f(v)}}function a(h){h.done?e(h.value):i(h.value).then(d,y)}a((o=o.apply(r,n||[])).next())})},Et=function(r,n){var t={label:0,sent:function(){if(e[0]&1)throw e[1];return e[1]},trys:[],ops:[]},o,i,e,f;return f={next:d(0),throw:d(1),return:d(2)},typeof Symbol=="function"&&(f[Symbol.iterator]=function(){return this}),f;function d(a){return function(h){return y([a,h])}}function y(a){if(o)throw new TypeError("Generator is already executing.");for(;t;)try{if(o=1,i&&(e=a[0]&2?i.return:a[0]?i.throw||((e=i.return)&&e.call(i),0):i.next)&&!(e=e.call(i,a[1])).done)return e;switch(i=0,e&&(a=[a[0]&2,e.value]),a[0]){case 0:case 1:e=a;break;case 4:return t.label++,{value:a[1],done:!1};case 5:t.label++,i=a[1],a=[0];continue;case 7:a=t.ops.pop(),t.trys.pop();continue;default:if(e=t.trys,!(e=e.length>0&&e[e.length-1])&&(a[0]===6||a[0]===2)){t=0;continue}if(a[0]===3&&(!e||a[1]>e[0]&&a[1]<e[3])){t.label=a[1];break}if(a[0]===6&&t.label<e[1]){t.label=e[1],e=a;break}if(e&&t.label<e[2]){t.label=e[2],t.ops.push(a);break}e[2]&&t.ops.pop(),t.trys.pop();continue}a=n.call(r,t)}catch(h){a=[6,h],i=0}finally{o=e=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}},z=Math.pow(1024,2);function Lt(r,n){var t=n*z;if(t>r.size)t=r.size;else for(;r.size>t*1e4;)t*=2;for(var o=[],i=Math.ceil(r.size/t),e=0;e<i;e++){var f=r.slice(t*e,e===i-1?r.size:t*(e+1));o.push(f)}return o}function Pt(r){return Object.keys(r).every(function(n){return n.indexOf("x-qn-meta-")===0})}function Tt(r){return Object.keys(r).every(function(n){return n.indexOf("x:")===0})}function Ht(r){return r.reduce(function(n,t){return n+t},0)}function Dt(r,n,t){try{localStorage.setItem(r,JSON.stringify(n))}catch{t.warn(new w(b.WriteCacheFailed,"setLocalFileInfo failed: "+r))}}function qt(r,n,t){var o=n==null?"_":"_key_"+n+"_";return"qiniu_js_sdk_upload_file_name_"+r+o+"size_"+t}function N(r,n){try{localStorage.removeItem(r)}catch{n.warn(new w(b.RemoveCacheFailed,"removeLocalFileInfo failed. key: "+r))}}function Bt(r,n){var t=null;try{t=localStorage.getItem(r)}catch{n.warn(new w(b.ReadCacheFailed,"getLocalFileInfo failed. key: "+r))}if(t==null)return null;var o=null;try{o=JSON.parse(t)}catch{N(r,n),n.warn(new w(b.InvalidCacheData,"getLocalFileInfo failed to parse. key: "+r))}return o}function $(r){var n="UpToken "+r;return{Authorization:n}}function Mt(r){var n=$(r);return M({"content-type":"application/octet-stream"},n)}function jt(r){var n=$(r);return M({"content-type":"application/json"},n)}function ct(){if(window.XMLHttpRequest)return new XMLHttpRequest;if(window.ActiveXObject)return new window.ActiveXObject("Microsoft.XMLHTTP");throw new w(b.NotAvailableXMLHttpRequest,"the current environment does not support.")}function $t(r){return Rt(this,void 0,void 0,function(){var n,t;return Et(this,function(o){switch(o.label){case 0:return[4,Gt(r)];case 1:return n=o.sent(),t=new zt.ArrayBuffer,t.append(n),[2,t.end()]}})})}function Gt(r){return new Promise(function(n,t){var o=new FileReader;o.onload=function(i){if(i.target){var e=i.target.result;n(e)}else t(new w(b.InvalidProgressEventTarget,"progress event target is undefined"))},o.onerror=function(){t(new w(b.FileReaderReadFailed,"fileReader read failed"))},o.readAsArrayBuffer(r)})}function q(r,n){return new Promise(function(t,o){var i=ct();if(i.open(n.method,r),n.onCreate&&n.onCreate(i),n.headers){var e=n.headers;Object.keys(e).forEach(function(f){i.setRequestHeader(f,e[f])})}i.upload.addEventListener("progress",function(f){f.lengthComputable&&n.onProgress&&n.onProgress({loaded:f.loaded,total:f.total})}),i.onreadystatechange=function(){var f=i.responseText;if(i.readyState===4){var d=i.getResponseHeader("x-reqId")||"";if(i.status===0){o(new bt("network error.",d));return}if(i.status!==200){var y="xhr request failed, code: "+i.status;f&&(y+=" response: "+f);var a=void 0;try{a=JSON.parse(f)}catch{}o(new D(i.status,d,y,a));return}try{t({data:JSON.parse(f),reqId:d})}catch(h){o(h)}}},i.send(n.body)})}function Vt(r){if(r&&r.match){var n=r.match(/(^https?)/);if(!n)return"";var t=n[1];return n=r.match(/^https?:\/\/([^:^/]*):(\d*)/),n?n[2]:t==="http"?"80":"443"}return""}function Nt(r){if(r&&r.match){var n=r.match(/^https?:\/\/([^:^/]*)/);return n?n[1]:""}return""}function J(r){if(!r)throw new w(b.InvalidToken,"invalid token.");var n=r.split(":");if(n.length===1)throw new w(b.InvalidToken,"invalid token segments.");var t=n.length>3?n[1]:n[0];if(!t)throw new w(b.InvalidToken,"missing assess key field.");var o=null;try{o=JSON.parse(Ft(n[n.length-1]))}catch{throw new w(b.InvalidToken,"token parse failed.")}if(o==null)throw new w(b.InvalidToken,"putPolicy is null.");if(o.scope==null)throw new w(b.InvalidToken,"scope field is null.");var i=o.scope.split(":")[0];if(!i)throw new w(b.InvalidToken,"resolve bucketName failed.");return{assessKey:t,bucketName:i,scope:o.scope}}function Xt(r){var n=window.URL||window.webkitURL||window.mozURL;return n.createObjectURL(r)}var U,O={z0:"z0",z1:"z1",z2:"z2",na0:"na0",as0:"as0",cnEast2:"cn-east-2"},Wt=(U={},U[O.z0]={srcUphost:["up.qiniup.com"],cdnUphost:["upload.qiniup.com"]},U[O.z1]={srcUphost:["up-z1.qiniup.com"],cdnUphost:["upload-z1.qiniup.com"]},U[O.z2]={srcUphost:["up-z2.qiniup.com"],cdnUphost:["upload-z2.qiniup.com"]},U[O.na0]={srcUphost:["up-na0.qiniup.com"],cdnUphost:["upload-na0.qiniup.com"]},U[O.as0]={srcUphost:["up-as0.qiniup.com"],cdnUphost:["upload-as0.qiniup.com"]},U[O.cnEast2]={srcUphost:["up-cn-east-2.qiniup.com"],cdnUphost:["upload-cn-east-2.qiniup.com"]},U),E=function(r){switch(typeof r){case"string":return r;case"boolean":return r?"true":"false";case"number":return isFinite(r)?r:"";default:return""}},Jt=function(r,n,t,o){return n=n||"&",t=t||"=",r===null&&(r=void 0),typeof r=="object"?Object.keys(r).map(function(i){var e=encodeURIComponent(E(i))+t;return Array.isArray(r[i])?r[i].map(function(f){return e+encodeURIComponent(E(f))}).join(n):e+encodeURIComponent(E(r[i]))}).filter(Boolean).join(n):o?encodeURIComponent(E(o))+t+encodeURIComponent(E(r)):""},lt;lt=Jt;var F=function(){return F=Object.assign||function(r){for(var n,t=1,o=arguments.length;t<o;t++){n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(r[i]=n[i])}return r},F.apply(this,arguments)},Kt=function(r,n,t,o){function i(e){return e instanceof t?e:new t(function(f){f(e)})}return new(t||(t=Promise))(function(e,f){function d(h){try{a(o.next(h))}catch(v){f(v)}}function y(h){try{a(o.throw(h))}catch(v){f(v)}}function a(h){h.done?e(h.value):i(h.value).then(d,y)}a((o=o.apply(r,n||[])).next())})},Zt=function(r,n){var t={label:0,sent:function(){if(e[0]&1)throw e[1];return e[1]},trys:[],ops:[]},o,i,e,f;return f={next:d(0),throw:d(1),return:d(2)},typeof Symbol=="function"&&(f[Symbol.iterator]=function(){return this}),f;function d(a){return function(h){return y([a,h])}}function y(a){if(o)throw new TypeError("Generator is already executing.");for(;t;)try{if(o=1,i&&(e=a[0]&2?i.return:a[0]?i.throw||((e=i.return)&&e.call(i),0):i.next)&&!(e=e.call(i,a[1])).done)return e;switch(i=0,e&&(a=[a[0]&2,e.value]),a[0]){case 0:case 1:e=a;break;case 4:return t.label++,{value:a[1],done:!1};case 5:t.label++,i=a[1],a=[0];continue;case 7:a=t.ops.pop(),t.trys.pop();continue;default:if(e=t.trys,!(e=e.length>0&&e[e.length-1])&&(a[0]===6||a[0]===2)){t=0;continue}if(a[0]===3&&(!e||a[1]>e[0]&&a[1]<e[3])){t.label=a[1];break}if(a[0]===6&&t.label<e[1]){t.label=e[1],e=a;break}if(e&&t.label<e[2]){t.label=e[2],t.ops.push(a);break}e[2]&&t.ops.pop(),t.trys.pop();continue}a=n.call(r,t)}catch(h){a=[6,h],i=0}finally{o=e=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}};function Yt(r,n,t){return Kt(this,void 0,void 0,function(){var o,i;return Zt(this,function(e){return o=lt({ak:r,bucket:n}),i=t+"://api.qiniu.com/v2/query?"+o,[2,q(i,{method:"GET"})]})})}function ht(r,n,t){var o=t.url,i=t.id;return o+"/buckets/"+r+"/objects/"+(n!=null?ut(n):"~")+"/uploads/"+i}function Qt(r,n,t,o){var i=o+"/buckets/"+n+"/objects/"+(t!=null?ut(t):"~")+"/uploads";return q(i,{method:"POST",headers:$(r)})}function te(r,n,t,o,i){var e=J(r).bucketName,f=ht(e,n,o)+("/"+t),d=Mt(r);return i.md5&&(d["Content-MD5"]=i.md5),q(f,F(F({},i),{method:"PUT",headers:d}))}function ee(r,n,t,o){var i=J(r).bucketName,e=ht(i,n,t);return q(e,F(F({},o),{method:"POST",headers:jt(r)}))}function ne(r,n,t){return q(r,F({method:"POST",body:n},t))}var j=function(){return j=Object.assign||function(r){for(var n,t=1,o=arguments.length;t<o;t++){n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(r[i]=n[i])}return r},j.apply(this,arguments)},Z=function(r,n,t,o){function i(e){return e instanceof t?e:new t(function(f){f(e)})}return new(t||(t=Promise))(function(e,f){function d(h){try{a(o.next(h))}catch(v){f(v)}}function y(h){try{a(o.throw(h))}catch(v){f(v)}}function a(h){h.done?e(h.value):i(h.value).then(d,y)}a((o=o.apply(r,n||[])).next())})},Y=function(r,n){var t={label:0,sent:function(){if(e[0]&1)throw e[1];return e[1]},trys:[],ops:[]},o,i,e,f;return f={next:d(0),throw:d(1),return:d(2)},typeof Symbol=="function"&&(f[Symbol.iterator]=function(){return this}),f;function d(a){return function(h){return y([a,h])}}function y(a){if(o)throw new TypeError("Generator is already executing.");for(;t;)try{if(o=1,i&&(e=a[0]&2?i.return:a[0]?i.throw||((e=i.return)&&e.call(i),0):i.next)&&!(e=e.call(i,a[1])).done)return e;switch(i=0,e&&(a=[a[0]&2,e.value]),a[0]){case 0:case 1:e=a;break;case 4:return t.label++,{value:a[1],done:!1};case 5:t.label++,i=a[1],a=[0];continue;case 7:a=t.ops.pop(),t.trys.pop();continue;default:if(e=t.trys,!(e=e.length>0&&e[e.length-1])&&(a[0]===6||a[0]===2)){t=0;continue}if(a[0]===3&&(!e||a[1]>e[0]&&a[1]<e[3])){t.label=a[1];break}if(a[0]===6&&t.label<e[1]){t.label=e[1],e=a;break}if(e&&t.label<e[2]){t.label=e[2],t.ops.push(a);break}e[2]&&t.ops.pop(),t.trys.pop();continue}a=n.call(r,t)}catch(h){a=[6,h],i=0}finally{o=e=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}},re=function(r,n){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var o=t.call(r),i,e=[],f;try{for(;(n===void 0||n-- >0)&&!(i=o.next()).done;)e.push(i.value)}catch(d){f={error:d}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(f)throw f.error}}return e},ie=function(){for(var r=[],n=0;n<arguments.length;n++)r=r.concat(re(arguments[n]));return r},oe=4,dt=[0,502,503,504,599],ae=ie(dt,[612]),se=Math.pow(1024,3),pt=function(){function r(n,t,o,i){this.hostPool=o,this.logger=i,this.aborted=!1,this.retryCount=0,this.xhrList=[],this.config=n.config,i.info("config inited.",this.config),this.putExtra=j({fname:""},n.putExtra),i.info("putExtra inited.",this.putExtra),this.key=n.key,this.file=n.file,this.token=n.token,this.onData=t.onData,this.onError=t.onError,this.onComplete=t.onComplete;try{var e=J(this.token);this.bucketName=e.bucketName,this.assessKey=e.assessKey}catch(f){i.error("get putPolicy from token failed.",f),this.onError(f)}}return r.prototype.checkAndUpdateUploadHost=function(){return Z(this,void 0,void 0,function(){var n;return Y(this,function(t){switch(t.label){case 0:return this.logger.info("get available upload host."),[4,this.hostPool.getUp(this.assessKey,this.bucketName,this.config.upprotocol)];case 1:if(n=t.sent(),n==null)throw new w(b.NotAvailableUploadHost,"no available upload host.");return this.uploadHost!=null&&this.uploadHost.host!==n.host?this.logger.warn("host switches from "+this.uploadHost.host+" to "+n.host+"."):this.logger.info("use host "+n.host+"."),this.uploadHost=n,[2]}})})},r.prototype.checkAndUnfreezeHost=function(){this.logger.info("check unfreeze host."),this.uploadHost!=null&&this.uploadHost.isFrozen()&&(this.logger.warn(this.uploadHost.host+" will be unfrozen."),this.uploadHost.unfreeze())},r.prototype.checkAndFreezeHost=function(n){this.logger.info("check freeze host."),n instanceof D&&this.uploadHost!=null&&dt.includes(n.code)&&(this.logger.warn(this.uploadHost.host+" will be temporarily frozen."),this.uploadHost.freeze())},r.prototype.handleError=function(n){this.logger.error(n.message),this.onError(n)},r.prototype.putFile=function(){return Z(this,void 0,void 0,function(){var n,t,o,i;return Y(this,function(e){switch(e.label){case 0:if(this.aborted=!1,this.putExtra.fname||(this.logger.info("use file.name as fname."),this.putExtra.fname=this.file.name),this.file.size>1e4*se)return this.handleError(new w(b.InvalidFile,"file size exceed maximum value 10000G")),[2];if(this.putExtra.customVars&&!Tt(this.putExtra.customVars))return this.handleError(new w(b.InvalidCustomVars,"customVars key should start width x:")),[2];if(this.putExtra.metadata&&!Pt(this.putExtra.metadata))return this.handleError(new w(b.InvalidMetadata,"metadata key should start with x-qn-meta-")),[2];e.label=1;case 1:return e.trys.push([1,4,,5]),this.uploadAt=new Date().getTime(),[4,this.checkAndUpdateUploadHost()];case 2:return e.sent(),[4,this.run()];case 3:return n=e.sent(),this.onComplete(n.data),this.checkAndUnfreezeHost(),this.sendLog(n.reqId,200),[2];case 4:return t=e.sent(),this.aborted?(this.logger.warn("upload is aborted."),this.sendLog("",-2),[2]):(this.clear(),this.logger.error(t),t instanceof D&&(this.sendLog(t.reqId,t.code),this.checkAndFreezeHost(t),o=++this.retryCount<=this.config.retryCount,i=ae.includes(t.code),i&&o)?(this.logger.warn("error auto retry: "+this.retryCount+"/"+this.config.retryCount+"."),this.putFile(),[2]):(this.onError(t),[3,5]));case 5:return[2]}})})},r.prototype.clear=function(){this.xhrList.forEach(function(n){n.onreadystatechange=null,n.abort()}),this.xhrList=[],this.logger.info("cleanup uploading xhr.")},r.prototype.stop=function(){this.logger.info("aborted."),this.clear(),this.aborted=!0},r.prototype.addXhr=function(n){this.xhrList.push(n)},r.prototype.sendLog=function(n,t){var o,i;this.logger.report({code:t,reqId:n,remoteIp:"",upType:"jssdk-h5",size:this.file.size,time:Math.floor(this.uploadAt/1e3),port:Vt((o=this.uploadHost)===null||o===void 0?void 0:o.getUrl()),host:Nt((i=this.uploadHost)===null||i===void 0?void 0:i.getUrl()),bytesSent:this.progress?this.progress.total.loaded:0,duration:Math.floor((new Date().getTime()-this.uploadAt)/1e3)})},r.prototype.getProgressInfoItem=function(n,t,o){return j({size:t,loaded:n,percent:n/t*100},o==null?{}:{fromCache:o})},r}(),ue=function(){var r=function(n,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var e in i)i.hasOwnProperty(e)&&(o[e]=i[e])},r(n,t)};return function(n,t){r(n,t);function o(){this.constructor=n}n.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}}(),H=function(){return H=Object.assign||function(r){for(var n,t=1,o=arguments.length;t<o;t++){n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(r[i]=n[i])}return r},H.apply(this,arguments)},L=function(r,n,t,o){function i(e){return e instanceof t?e:new t(function(f){f(e)})}return new(t||(t=Promise))(function(e,f){function d(h){try{a(o.next(h))}catch(v){f(v)}}function y(h){try{a(o.throw(h))}catch(v){f(v)}}function a(h){h.done?e(h.value):i(h.value).then(d,y)}a((o=o.apply(r,n||[])).next())})},P=function(r,n){var t={label:0,sent:function(){if(e[0]&1)throw e[1];return e[1]},trys:[],ops:[]},o,i,e,f;return f={next:d(0),throw:d(1),return:d(2)},typeof Symbol=="function"&&(f[Symbol.iterator]=function(){return this}),f;function d(a){return function(h){return y([a,h])}}function y(a){if(o)throw new TypeError("Generator is already executing.");for(;t;)try{if(o=1,i&&(e=a[0]&2?i.return:a[0]?i.throw||((e=i.return)&&e.call(i),0):i.next)&&!(e=e.call(i,a[1])).done)return e;switch(i=0,e&&(a=[a[0]&2,e.value]),a[0]){case 0:case 1:e=a;break;case 4:return t.label++,{value:a[1],done:!1};case 5:t.label++,i=a[1],a=[0];continue;case 7:a=t.ops.pop(),t.trys.pop();continue;default:if(e=t.trys,!(e=e.length>0&&e[e.length-1])&&(a[0]===6||a[0]===2)){t=0;continue}if(a[0]===3&&(!e||a[1]>e[0]&&a[1]<e[3])){t.label=a[1];break}if(a[0]===6&&t.label<e[1]){t.label=e[1],e=a;break}if(e&&t.label<e[2]){t.label=e[2],t.ops.push(a);break}e[2]&&t.ops.pop(),t.trys.pop();continue}a=n.call(r,t)}catch(h){a=[6,h],i=0}finally{o=e=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}};function fe(r){var n=/^[1-9]\d*$/;return n.test(String(r))}var ce=function(r){ue(n,r);function n(){return r!==null&&r.apply(this,arguments)||this}return n.prototype.run=function(){return L(this,void 0,void 0,function(){var t,o,i,e,f,d=this;return P(this,function(y){switch(y.label){case 0:if(this.logger.info("start run Resume."),!this.config.chunkSize||!fe(this.config.chunkSize))throw new w(b.InvalidChunkSize,"chunkSize must be a positive integer");if(this.config.chunkSize>1024)throw new w(b.InvalidChunkSize,"chunkSize maximum value is 1024");return[4,this.initBeforeUploadChunks()];case 1:y.sent(),t=new wt(function(a){return L(d,void 0,void 0,function(){return P(this,function(h){switch(h.label){case 0:if(this.aborted)throw t.abort(),new Error("pool is aborted");return[4,this.uploadChunk(a)];case 1:return h.sent(),[2]}})})},this.config.concurrentRequestLimit),o=null,i=this.getLocalKey(),e=this.chunks.map(function(a,h){return t.enqueue({chunk:a,index:h})}),y.label=2;case 2:return y.trys.push([2,5,,6]),[4,Promise.all(e)];case 3:return y.sent(),[4,this.mkFileReq()];case 4:return o=y.sent(),[3,6];case 5:throw f=y.sent(),f instanceof D&&(f.code===612||f.code===400)&&N(i,this.logger),f;case 6:return N(i,this.logger),[2,o]}})})},n.prototype.uploadChunk=function(t){return L(this,void 0,void 0,function(){var o,i,e,f,d,y,a,h,v,_=this;return P(this,function(x){switch(x.label){case 0:return o=t.index,i=t.chunk,e=this.cachedUploadedList[o],this.logger.info("upload part "+o+", cache:",e),f=this.config.checkByMD5,d=function(){_.usedCacheList[o]=!0,_.updateChunkProgress(i.size,o),_.uploadedList[o]=e,_.updateLocalCache()},e&&!f?(d(),[2]):[4,$t(i)];case 1:return y=x.sent(),this.logger.info("computed part md5.",y),e&&y===e.md5?(d(),[2]):(this.usedCacheList[o]=!1,a=function(S){_.updateChunkProgress(S.loaded,o)},h={body:i,md5:this.config.checkByServer?y:void 0,onProgress:a,onCreate:function(S){return _.addXhr(S)}},this.logger.info("part "+o+" start uploading."),[4,te(this.token,this.key,t.index+1,this.getUploadInfo(),h)]);case 2:return v=x.sent(),this.logger.info("part "+o+" upload completed."),a({loaded:i.size,total:i.size}),this.uploadedList[o]={etag:v.data.etag,md5:v.data.md5,size:i.size},this.updateLocalCache(),[2]}})})},n.prototype.mkFileReq=function(){return L(this,void 0,void 0,function(){var t,o,i=this;return P(this,function(e){switch(e.label){case 0:return t=H(H(H({parts:this.uploadedList.map(function(f,d){return{etag:f.etag,partNumber:d+1}}),fname:this.putExtra.fname},this.putExtra.mimeType&&{mimeType:this.putExtra.mimeType}),this.putExtra.customVars&&{customVars:this.putExtra.customVars}),this.putExtra.metadata&&{metadata:this.putExtra.metadata}),this.logger.info("parts upload completed, make file.",t),[4,ee(this.token,this.key,this.getUploadInfo(),{onCreate:function(f){return i.addXhr(f)},body:JSON.stringify(t)})];case 1:return o=e.sent(),this.logger.info("finish Resume Progress."),this.updateMkFileProgress(1),[2,o]}})})},n.prototype.initBeforeUploadChunks=function(){return L(this,void 0,void 0,function(){var t,o,i;return P(this,function(e){switch(e.label){case 0:return this.uploadedList=[],this.usedCacheList=[],t=Bt(this.getLocalKey(),this.logger),t?[3,2]:(this.logger.info("init upload parts from api."),[4,Qt(this.token,this.bucketName,this.key,this.uploadHost.getUrl())]);case 1:return o=e.sent(),this.logger.info("initd upload parts of id: "+o.data.uploadId+"."),this.uploadId=o.data.uploadId,this.cachedUploadedList=[],[3,3];case 2:i=["resume upload parts from local cache,","total "+t.data.length+" part,","id is "+t.id+"."],this.logger.info(i.join(" ")),this.cachedUploadedList=t.data,this.uploadId=t.id,e.label=3;case 3:return this.chunks=Lt(this.file,this.config.chunkSize),this.loaded={mkFileProgress:0,chunks:this.chunks.map(function(f){return 0})},this.notifyResumeProgress(),[2]}})})},n.prototype.getUploadInfo=function(){return{id:this.uploadId,url:this.uploadHost.getUrl()}},n.prototype.getLocalKey=function(){return qt(this.file.name,this.key,this.file.size)},n.prototype.updateLocalCache=function(){Dt(this.getLocalKey(),{id:this.uploadId,data:this.uploadedList},this.logger)},n.prototype.updateChunkProgress=function(t,o){this.loaded.chunks[o]=t,this.notifyResumeProgress()},n.prototype.updateMkFileProgress=function(t){this.loaded.mkFileProgress=t,this.notifyResumeProgress()},n.prototype.notifyResumeProgress=function(){var t=this;this.progress={total:this.getProgressInfoItem(Ht(this.loaded.chunks)+this.loaded.mkFileProgress,this.file.size+1),chunks:this.chunks.map(function(o,i){var e=t.usedCacheList[i];return t.getProgressInfoItem(t.loaded.chunks[i],o.size,e)}),uploadInfo:{id:this.uploadId,url:this.uploadHost.getUrl()}},this.onData(this.progress)},n}(pt),Q=function(r,n,t,o){function i(e){return e instanceof t?e:new t(function(f){f(e)})}return new(t||(t=Promise))(function(e,f){function d(h){try{a(o.next(h))}catch(v){f(v)}}function y(h){try{a(o.throw(h))}catch(v){f(v)}}function a(h){h.done?e(h.value):i(h.value).then(d,y)}a((o=o.apply(r,n||[])).next())})},tt=function(r,n){var t={label:0,sent:function(){if(e[0]&1)throw e[1];return e[1]},trys:[],ops:[]},o,i,e,f;return f={next:d(0),throw:d(1),return:d(2)},typeof Symbol=="function"&&(f[Symbol.iterator]=function(){return this}),f;function d(a){return function(h){return y([a,h])}}function y(a){if(o)throw new TypeError("Generator is already executing.");for(;t;)try{if(o=1,i&&(e=a[0]&2?i.return:a[0]?i.throw||((e=i.return)&&e.call(i),0):i.next)&&!(e=e.call(i,a[1])).done)return e;switch(i=0,e&&(a=[a[0]&2,e.value]),a[0]){case 0:case 1:e=a;break;case 4:return t.label++,{value:a[1],done:!1};case 5:t.label++,i=a[1],a=[0];continue;case 7:a=t.ops.pop(),t.trys.pop();continue;default:if(e=t.trys,!(e=e.length>0&&e[e.length-1])&&(a[0]===6||a[0]===2)){t=0;continue}if(a[0]===3&&(!e||a[1]>e[0]&&a[1]<e[3])){t.label=a[1];break}if(a[0]===6&&t.label<e[1]){t.label=e[1],e=a;break}if(e&&t.label<e[2]){t.label=e[2],t.ops.push(a);break}e[2]&&t.ops.pop(),t.trys.pop();continue}a=n.call(r,t)}catch(h){a=[6,h],i=0}finally{o=e=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}},le=function(){function r(){this.crc=-1,this.table=this.makeTable()}return r.prototype.makeTable=function(){for(var n=new Array,t=0;t<256;t++){for(var o=t,i=0;i<8;i++)o&1?o=o>>>1^3988292384:o>>>=1;n[t]=o}return n},r.prototype.append=function(n){for(var t=this.crc,o=0;o<n.byteLength;o++)t=t>>>8^this.table[(t^n[o])&255];this.crc=t},r.prototype.compute=function(){return(this.crc^-1)>>>0},r.prototype.readAsUint8Array=function(n){return Q(this,void 0,void 0,function(){var t;return tt(this,function(o){switch(o.label){case 0:return typeof n.arrayBuffer!="function"?[3,2]:(t=Uint8Array.bind,[4,n.arrayBuffer()]);case 1:return[2,new(t.apply(Uint8Array,[void 0,o.sent()]))];case 2:return[2,new Promise(function(i,e){var f=new FileReader;f.onload=function(){if(f.result==null){e();return}if(typeof f.result=="string"){e();return}i(new Uint8Array(f.result))},f.readAsArrayBuffer(n)})]}})})},r.prototype.file=function(n){return Q(this,void 0,void 0,function(){var t,o,i,e,f,d;return tt(this,function(y){switch(y.label){case 0:return n.size<=z?(t=this.append,[4,this.readAsUint8Array(n)]):[3,2];case 1:return t.apply(this,[y.sent()]),[2,this.compute()];case 2:o=Math.ceil(n.size/z),i=0,y.label=3;case 3:return i<o?(e=i*z,f=i===o-1?n.size:e+z,[4,this.readAsUint8Array(n.slice(e,f))]):[3,6];case 4:d=y.sent(),this.append(new Uint8Array(d)),y.label=5;case 5:return i++,[3,3];case 6:return[2,this.compute()]}})})},r.file=function(n){var t=new r;return t.file(n)},r}(),he=function(){var r=function(n,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var e in i)i.hasOwnProperty(e)&&(o[e]=i[e])},r(n,t)};return function(n,t){r(n,t);function o(){this.constructor=n}n.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}}(),de=function(r,n,t,o){function i(e){return e instanceof t?e:new t(function(f){f(e)})}return new(t||(t=Promise))(function(e,f){function d(h){try{a(o.next(h))}catch(v){f(v)}}function y(h){try{a(o.throw(h))}catch(v){f(v)}}function a(h){h.done?e(h.value):i(h.value).then(d,y)}a((o=o.apply(r,n||[])).next())})},pe=function(r,n){var t={label:0,sent:function(){if(e[0]&1)throw e[1];return e[1]},trys:[],ops:[]},o,i,e,f;return f={next:d(0),throw:d(1),return:d(2)},typeof Symbol=="function"&&(f[Symbol.iterator]=function(){return this}),f;function d(a){return function(h){return y([a,h])}}function y(a){if(o)throw new TypeError("Generator is already executing.");for(;t;)try{if(o=1,i&&(e=a[0]&2?i.return:a[0]?i.throw||((e=i.return)&&e.call(i),0):i.next)&&!(e=e.call(i,a[1])).done)return e;switch(i=0,e&&(a=[a[0]&2,e.value]),a[0]){case 0:case 1:e=a;break;case 4:return t.label++,{value:a[1],done:!1};case 5:t.label++,i=a[1],a=[0];continue;case 7:a=t.ops.pop(),t.trys.pop();continue;default:if(e=t.trys,!(e=e.length>0&&e[e.length-1])&&(a[0]===6||a[0]===2)){t=0;continue}if(a[0]===3&&(!e||a[1]>e[0]&&a[1]<e[3])){t.label=a[1];break}if(a[0]===6&&t.label<e[1]){t.label=e[1],e=a;break}if(e&&t.label<e[2]){t.label=e[2],t.ops.push(a);break}e[2]&&t.ops.pop(),t.trys.pop();continue}a=n.call(r,t)}catch(h){a=[6,h],i=0}finally{o=e=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}},et=function(r){he(n,r);function n(){return r!==null&&r.apply(this,arguments)||this}return n.prototype.run=function(){return de(this,void 0,void 0,function(){var t,o,i,e,f,d=this;return pe(this,function(y){switch(y.label){case 0:return this.logger.info("start run Direct."),t=new FormData,t.append("file",this.file),t.append("token",this.token),this.key!=null&&t.append("key",this.key),t.append("fname",this.putExtra.fname),this.config.checkByServer?[4,le.file(this.file)]:[3,2];case 1:o=y.sent(),t.append("crc32",o.toString()),y.label=2;case 2:return this.putExtra.customVars&&(this.logger.info("init customVars."),i=this.putExtra.customVars,Object.keys(i).forEach(function(a){return t.append(a,i[a].toString())}),this.logger.info("customVars inited.")),this.putExtra.metadata&&(this.logger.info("init metadata."),e=this.putExtra.metadata,Object.keys(e).forEach(function(a){return t.append(a,e[a].toString())})),this.logger.info("formData inited."),[4,ne(this.uploadHost.getUrl(),t,{onProgress:function(a){d.updateDirectProgress(a.loaded,a.total)},onCreate:function(a){return d.addXhr(a)}})];case 3:return f=y.sent(),this.logger.info("Direct progress finish."),this.finishDirectProgress(),[2,f]}})})},n.prototype.updateDirectProgress=function(t,o){this.progress={total:this.getProgressInfoItem(t,o+1)},this.onData(this.progress)},n.prototype.finishDirectProgress=function(){if(!this.progress){this.logger.warn("progress is null."),this.progress={total:this.getProgressInfoItem(this.file.size,this.file.size)},this.onData(this.progress);return}var t=this.progress.total;this.progress={total:this.getProgressInfoItem(t.loaded+1,t.size)},this.onData(this.progress)},n}(pt);function gt(r,n,t){t===void 0&&(t=3);var o=ct();o.open("POST","https://uplog.qbox.me/log/3"),o.setRequestHeader("Content-type","application/x-www-form-urlencoded"),o.setRequestHeader("Authorization",$(r).Authorization),o.onreadystatechange=function(){o.readyState===4&&o.status!==200&&t>0&&gt(r,n,t-1)};var i=[n.code||"",n.reqId||"",n.host||"",n.remoteIp||"",n.port||"",n.duration||"",n.time||"",n.bytesSent||"",n.upType||"",n.size||""].join(",");o.send(i)}var ge=function(r,n){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var o=t.call(r),i,e=[],f;try{for(;(n===void 0||n-- >0)&&!(i=o.next()).done;)e.push(i.value)}catch(d){f={error:d}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(f)throw f.error}}return e},G=function(){for(var r=[],n=0;n<arguments.length;n++)r=r.concat(ge(arguments[n]));return r},ye=function(){function r(n,t,o,i){t===void 0&&(t=!0),o===void 0&&(o="OFF"),i===void 0&&(i="UPLOAD"),this.token=n,this.disableReport=t,this.level=o,this.prefix=i,this.id=++r.id}return r.prototype.getPrintPrefix=function(n){return"Qiniu-JS-SDK ["+n+"]["+this.prefix+"#"+this.id+"]:"},r.prototype.report=function(n,t){if(!this.disableReport)try{gt(this.token,n,t)}catch(o){this.warn(o)}},r.prototype.info=function(){for(var n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];var o=["INFO"];o.includes(this.level)&&console.log.apply(console,G([this.getPrintPrefix("INFO")],n))},r.prototype.warn=function(){for(var n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];var o=["INFO","WARN"];o.includes(this.level)&&console.warn.apply(console,G([this.getPrintPrefix("WARN")],n))},r.prototype.error=function(){for(var n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];var o=["INFO","WARN","ERROR"];o.includes(this.level)&&console.error.apply(console,G([this.getPrintPrefix("ERROR")],n))},r.id=0,r}(),nt=function(r,n,t,o){function i(e){return e instanceof t?e:new t(function(f){f(e)})}return new(t||(t=Promise))(function(e,f){function d(h){try{a(o.next(h))}catch(v){f(v)}}function y(h){try{a(o.throw(h))}catch(v){f(v)}}function a(h){h.done?e(h.value):i(h.value).then(d,y)}a((o=o.apply(r,n||[])).next())})},rt=function(r,n){var t={label:0,sent:function(){if(e[0]&1)throw e[1];return e[1]},trys:[],ops:[]},o,i,e,f;return f={next:d(0),throw:d(1),return:d(2)},typeof Symbol=="function"&&(f[Symbol.iterator]=function(){return this}),f;function d(a){return function(h){return y([a,h])}}function y(a){if(o)throw new TypeError("Generator is already executing.");for(;t;)try{if(o=1,i&&(e=a[0]&2?i.return:a[0]?i.throw||((e=i.return)&&e.call(i),0):i.next)&&!(e=e.call(i,a[1])).done)return e;switch(i=0,e&&(a=[a[0]&2,e.value]),a[0]){case 0:case 1:e=a;break;case 4:return t.label++,{value:a[1],done:!1};case 5:t.label++,i=a[1],a=[0];continue;case 7:a=t.ops.pop(),t.trys.pop();continue;default:if(e=t.trys,!(e=e.length>0&&e[e.length-1])&&(a[0]===6||a[0]===2)){t=0;continue}if(a[0]===3&&(!e||a[1]>e[0]&&a[1]<e[3])){t.label=a[1];break}if(a[0]===6&&t.label<e[1]){t.label=e[1],e=a;break}if(e&&t.label<e[2]){t.label=e[2],t.ops.push(a);break}e[2]&&t.ops.pop(),t.trys.pop();continue}a=n.call(r,t)}catch(h){a=[6,h],i=0}finally{o=e=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}},ve=function(r,n){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var o=t.call(r),i,e=[],f;try{for(;(n===void 0||n-- >0)&&!(i=o.next()).done;)e.push(i.value)}catch(d){f={error:d}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(f)throw f.error}}return e},me=function(){for(var r=[],n=0;n<arguments.length;n++)r=r.concat(ve(arguments[n]));return r},B=new Map,be=function(){function r(n,t){this.host=n,this.protocol=t}return r.prototype.isFrozen=function(){var n=new Date().getTime(),t=B.get(this.host);return t!=null&&t>=n},r.prototype.freeze=function(n){n===void 0&&(n=20);var t=new Date().getTime()+n*1e3;B.set(this.host,t)},r.prototype.unfreeze=function(){B.delete(this.host)},r.prototype.getUrl=function(){return this.protocol+"://"+this.host},r.prototype.getUnfreezeTime=function(){return B.get(this.host)},r}(),we=function(){function r(n){n===void 0&&(n=[]),this.initHosts=n,this.cachedHostsMap=new Map}return r.prototype.register=function(n,t,o,i){this.cachedHostsMap.set(n+"@"+t,o.map(function(e){return new be(e,i)}))},r.prototype.refresh=function(n,t,o){var i,e,f,d;return nt(this,void 0,void 0,function(){var y,a,h;return rt(this,function(v){switch(v.label){case 0:return y=this.cachedHostsMap.get(n+"@"+t)||[],y.length>0?[2]:this.initHosts.length>0?(this.register(n,t,this.initHosts,o),[2]):[4,Yt(n,t,o)];case 1:return a=v.sent(),(a==null?void 0:a.data)!=null&&(h=me(((e=(i=a.data.up)===null||i===void 0?void 0:i.acc)===null||e===void 0?void 0:e.main)||[],((d=(f=a.data.up)===null||f===void 0?void 0:f.acc)===null||d===void 0?void 0:d.backup)||[]),this.register(n,t,h,o)),[2]}})})},r.prototype.getUp=function(n,t,o){return nt(this,void 0,void 0,function(){var i,e,f;return rt(this,function(d){switch(d.label){case 0:return[4,this.refresh(n,t,o)];case 1:return d.sent(),i=this.cachedHostsMap.get(n+"@"+t)||[],i.length===0?[2,null]:(e=i.filter(function(y){return!y.isFrozen()}),e.length>0?[2,e[0]]:(f=i.slice().sort(function(y,a){return(y.getUnfreezeTime()||0)-(a.getUnfreezeTime()||0)}),[2,f[0]]))}})})},r}();function _e(r,n,t,o){return r.config&&r.config.forceDirect?(o.info("ues forceDirect mode."),new et(r,n,t,o)):r.file.size>4*z?(o.info("file size over 4M, use Resume."),new ce(r,n,t,o)):(o.info("file size less or equal than 4M, use Direct."),new et(r,n,t,o))}function yt(r,n,t,o,i){var e=new ye(t,i==null?void 0:i.disableStatisticsReport,i==null?void 0:i.debugLogLevel,r.name),f={file:r,key:n,token:t,putExtra:o,config:Se(i,e)},d=new we(f.config.uphost);return new St(function(y){var a=_e(f,{onData:function(h){return y.next(h)},onError:function(h){return y.error(h)},onComplete:function(h){return y.complete(h)}},d,e);return a.putFile(),a.stop.bind(a)})}var R=function(){return R=Object.assign||function(r){for(var n,t=1,o=arguments.length;t<o;t++){n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(r[i]=n[i])}return r},R.apply(this,arguments)},xe=function(r,n){var t={};for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&n.indexOf(o)<0&&(t[o]=r[o]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,o=Object.getOwnPropertySymbols(r);i<o.length;i++)n.indexOf(o[i])<0&&Object.prototype.propertyIsEnumerable.call(r,o[i])&&(t[o[i]]=r[o[i]]);return t},Ce=function(r,n){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var o=t.call(r),i,e=[],f;try{for(;(n===void 0||n-- >0)&&!(i=o.next()).done;)e.push(i.value)}catch(d){f={error:d}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(f)throw f.error}}return e},V=function(){for(var r=[],n=0;n<arguments.length;n++)r=r.concat(Ce(arguments[n]));return r};function Se(r,n){var t=R({},r),o=t.upprotocol,i=t.uphost,e=xe(t,["upprotocol","uphost"]),f=R({uphost:[],retryCount:3,checkByMD5:!1,forceDirect:!1,useCdnDomain:!0,checkByServer:!1,concurrentRequestLimit:3,chunkSize:oe,upprotocol:"https",debugLogLevel:"OFF",disableStatisticsReport:!1},e);o&&(f.upprotocol=o.replace(/:$/,""));var d=[];if(n&&(r==null?void 0:r.uphost)!=null&&(r==null?void 0:r.region)!=null&&n.warn("do not use both the uphost and region config."),i)Array.isArray(i)?d.push.apply(d,V(i)):d.push(i);else if(f!=null&&f.region){var y=Wt[f==null?void 0:f.region];f.useCdnDomain?d.push.apply(d,V(y.cdnUphost)):d.push.apply(d,V(y.srcUphost))}return R(R({},f),{uphost:d.filter(Boolean)})}var X=function(){return X=Object.assign||function(r){for(var n,t=1,o=arguments.length;t<o;t++){n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(r[i]=n[i])}return r},X.apply(this,arguments)},it=function(r,n,t,o){function i(e){return e instanceof t?e:new t(function(f){f(e)})}return new(t||(t=Promise))(function(e,f){function d(h){try{a(o.next(h))}catch(v){f(v)}}function y(h){try{a(o.throw(h))}catch(v){f(v)}}function a(h){h.done?e(h.value):i(h.value).then(d,y)}a((o=o.apply(r,n||[])).next())})},ot=function(r,n){var t={label:0,sent:function(){if(e[0]&1)throw e[1];return e[1]},trys:[],ops:[]},o,i,e,f;return f={next:d(0),throw:d(1),return:d(2)},typeof Symbol=="function"&&(f[Symbol.iterator]=function(){return this}),f;function d(a){return function(h){return y([a,h])}}function y(a){if(o)throw new TypeError("Generator is already executing.");for(;t;)try{if(o=1,i&&(e=a[0]&2?i.return:a[0]?i.throw||((e=i.return)&&e.call(i),0):i.next)&&!(e=e.call(i,a[1])).done)return e;switch(i=0,e&&(a=[a[0]&2,e.value]),a[0]){case 0:case 1:e=a;break;case 4:return t.label++,{value:a[1],done:!1};case 5:t.label++,i=a[1],a=[0];continue;case 7:a=t.ops.pop(),t.trys.pop();continue;default:if(e=t.trys,!(e=e.length>0&&e[e.length-1])&&(a[0]===6||a[0]===2)){t=0;continue}if(a[0]===3&&(!e||a[1]>e[0]&&a[1]<e[3])){t.label=a[1];break}if(a[0]===6&&t.label<e[1]){t.label=e[1],e=a;break}if(e&&t.label<e[2]){t.label=e[2],t.ops.push(a);break}e[2]&&t.ops.pop(),t.trys.pop();continue}a=n.call(r,t)}catch(h){a=[6,h],i=0}finally{o=e=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}},W={PNG:"image/png",JPEG:"image/jpeg",WEBP:"image/webp",BMP:"image/bmp"},Ae=4,ke=Math.log(2),Ie=Object.keys(W).map(function(r){return W[r]}),Ue=W.JPEG;function Fe(r){return Ie.includes(r)}var Oe=function(){function r(n,t){this.file=n,this.config=t,this.config=X({quality:.92,noCompressIfLarger:!1},this.config)}return r.prototype.process=function(){return it(this,void 0,void 0,function(){var n,t,o,i,e,f;return ot(this,function(d){switch(d.label){case 0:if(this.outputType=this.file.type,n={},!Fe(this.file.type))throw new w(b.UnsupportedFileType,"unsupported file type: "+this.file.type);return[4,this.getOriginImage()];case 1:return t=d.sent(),[4,this.getCanvas(t)];case 2:return o=d.sent(),i=1,this.config.maxWidth&&(i=Math.min(1,this.config.maxWidth/o.width)),this.config.maxHeight&&(i=Math.min(1,i,this.config.maxHeight/o.height)),n.width=o.width,n.height=o.height,[4,this.doScale(o,i)];case 3:return e=d.sent(),f=this.toBlob(e),f.size>this.file.size&&this.config.noCompressIfLarger?[2,{dist:this.file,width:n.width,height:n.height}]:[2,{dist:f,width:e.width,height:e.height}]}})})},r.prototype.clear=function(n,t,o){this.outputType===Ue?(n.fillStyle="#fff",n.fillRect(0,0,t,o)):n.clearRect(0,0,t,o)},r.prototype.getOriginImage=function(){var n=this;return new Promise(function(t,o){var i=Xt(n.file),e=new Image;e.onload=function(){t(e)},e.onerror=function(){o("image load error")},e.src=i})},r.prototype.getCanvas=function(n){var t=this;return new Promise(function(o,i){var e=document.createElement("canvas"),f=e.getContext("2d");if(!f){i(new w(b.GetCanvasContextFailed,"context is null"));return}var d=n.width,y=n.height;e.height=y,e.width=d,t.clear(f,d,y),f.drawImage(n,0,0),o(e)})},r.prototype.doScale=function(n,t){return it(this,void 0,void 0,function(){var o,i,e,f,d,y,a,h,v,_,x,S,A,m,g,p;return ot(this,function(u){if(t===1)return[2,n];if(o=n.getContext("2d"),i=Math.min(Ae,Math.ceil(1/t/ke)),e=Math.pow(t,1/i),f=document.createElement("canvas"),d=f.getContext("2d"),y=n.width,a=n.height,h=y,v=a,f.width=y,f.height=a,!d||!o)throw new w(b.GetCanvasContextFailed,"mctx or sctx can't be null");for(S=0;S<i;S++)A=y*e|0,m=a*e|0,S===i-1&&(A=h*t,m=v*t),S%2===0?(_=n,x=d):(_=f,x=o),this.clear(x,y,a),x.drawImage(_,0,0,y,a,0,0,A,m),y=A,a=m;return g=_===n?f:n,p=x.getImageData(0,0,y,a),g.width=y,g.height=a,x.putImageData(p,0,0),[2,g]})})},r.prototype.toBlob=function(n){var t=n.toDataURL(this.outputType,this.config.quality),o=atob(t.split(",")[1]).split("").map(function(e){return e.charCodeAt(0)}),i=new Blob([new Uint8Array(o)],{type:this.outputType});return i},r}(),Ee=function(r,n){return new Oe(r,n).process()};function Le(r,n=null,t,o,i,e){return yt(r,n,t,i,e).subscribe(o)}function Pe(r,n=null,t,o,i){return yt(r,n,t,o,i)}const vt=new Map([[298,""],[400,""],[401,""],[403,""],[404,""],[405,""],[406," CRC32 "],[413,""],[419,""],[478,""],[502,""],[503,""],[504,""],[573,""],[579,""],[599,""],[608,""],[612,""],[614,""],[630,""],[631,""],[640,"(list)marker"],[701,"ctx"]]);Object.freeze(vt);function Te(r){return vt.get(r)||""}function He(r,n){return at.get(`/res/user/${r}`,{},{headers:{Authorization:n}})}function De(r,n){return at.deleted(`/res/user/files?key=${r}`,{},{headers:{Authorization:n}})}var ze=(r=>(r.IMAGE="image",r.VIDEO="video",r.FILE="file",r.FONT="font",r))(ze||{});export{ze as O,Te as a,Le as b,Ee as c,De as d,He as g,Pe as u};
